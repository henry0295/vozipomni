;============================================================================
; VoziPOmni Contact Center - PJSIP Configuration
;============================================================================

[global]
type=global
max_forwards=70
user_agent=VoziPOmni-Asterisk
default_outbound_endpoint=default_outbound

[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
tos=cs3
cos=3
allow_reload=yes

[transport-tcp]
type=transport
protocol=tcp
bind=0.0.0.0:5060
tos=cs3
cos=3

[transport-wss]
type=transport
protocol=wss
bind=0.0.0.0:8089
tos=cs3
cos=3
cert_file=/etc/asterisk/keys/asterisk.pem
priv_key_file=/etc/asterisk/keys/asterisk.key
cipher=ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256
method=tlsv1_2

; Template para agentes WebRTC
[webrtc_endpoint](!)
type=endpoint
transport=transport-wss
context=from-internal
disallow=all
allow=opus,ulaw,alaw
webrtc=yes
dtls_auto_generate_cert=yes
dtls_verify=fingerprint
dtls_setup=actpass
ice_support=yes
media_encryption=dtls
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
direct_media=no

; Template para agentes SIP tradicional
[sip_endpoint](!)
type=endpoint
transport=transport-udp
context=from-internal
disallow=all
allow=ulaw,alaw,g722,gsm
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes

; Ejemplo de agente WebRTC
[agent1000](webrtc_endpoint)
auth=agent1000-auth
aors=agent1000-aor

[agent1000-auth]
type=auth
auth_type=userpass
username=agent1000
password=VoziPOmni2026!

[agent1000-aor]
type=aor
max_contacts=1
remove_existing=yes

; Configuración para troncales SIP (ejemplo)
[trunk_provider](!)
type=endpoint
context=from-external
transport=transport-udp
disallow=all
allow=ulaw,alaw
direct_media=no

;============================================================================
; TRANSPORTS PARA TRONCALES SIP
; Siguiendo la arquitectura de OmniLeads:
; - trunk-nat-transport: Puerto 5162 con NAT (IP pública en external_*)
; - trunk-transport: Puerto 5161 sin NAT (VPS con IP pública o LAN)
;============================================================================

; Transport específico para troncales con NAT
; Usa puerto 5162 (como OmniLeads) para evitar conflicto con transport-udp
; IMPORTANTE: external_media_address y external_signaling_address son
; inyectados automáticamente por entrypoint.sh usando VOZIPOMNI_IPV4.
; NO definirlos vacíos aquí o Asterisk fallará al cargar el transport.
[trunk-nat-transport]
type=transport
protocol=udp
bind=0.0.0.0:5162
; external_media_address= (inyectado por entrypoint.sh)
; external_signaling_address= (inyectado por entrypoint.sh)
local_net=192.168.0.0/16
local_net=10.0.0.0/8
local_net=172.16.0.0/12
local_net=172.20.0.0/16
local_net=100.64.0.0/10
tos=cs3
cos=3

; Transport para troncales sin NAT (VPS con IP pública, PBX en LAN, corporativo)
; Usa puerto 5161 (como OmniLeads) para evitar conflicto con transport-udp
[trunk-transport]
type=transport
protocol=udp
bind=0.0.0.0:5161
tos=cs3
cos=3

;============================================================================
; CONFIGURACIÓN DINÁMICA
; Estos archivos son generados automáticamente desde la interfaz web
;============================================================================

; Extensiones PJSIP de agentes (generado por AsteriskConfigGenerator)
#include /var/lib/asterisk/dynamic/pjsip_extensions.conf

; Troncales SIP via PJSIP Wizard (generado por PJSIPConfigGenerator)
#include /var/lib/asterisk/dynamic/pjsip_wizard.conf
